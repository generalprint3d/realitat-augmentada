<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Realitat Augmentada Olla de N√∫ria 4164 m de radi</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: black;
}
#camera {
  position: fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  object-fit: cover;
  z-index:1;
}
#map {
  position: fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  z-index:2;
  background: transparent;
}
#controls {
  position: fixed;
  bottom:20px;
  left:20px;
  right:20px;
  z-index:999;
  background: rgba(0,0,0,0.5);
  padding:10px;
  border-radius:10px;
  color:white;
  font-family:sans-serif;
}
</style>
</head>

<body>

<video id="camera" autoplay playsinline muted></video>
<div id="map"></div>

<div id="controls">
Transpar√®ncia mapa:
<input type="range" id="opacity" min="0" max="1" step="0.05" value="0.7">
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-omnivore/leaflet-omnivore.min.js"></script>

<script>
// üì∑ activar c√†mera
navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
.then(stream => {
  document.getElementById("camera").srcObject = stream;
})
.catch(err => {
  alert("Error c√†mera: " + err);
});

// üó∫Ô∏è mapa base
var map = L.map('map', {
  zoomControl: true,
  attributionControl: false
}).setView([42.13, 1.78], 13);

// üåç OSM
var osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  maxZoom:19,
  opacity:0.7
}).addTo(map);

// Slider transpar√®ncia
const opacitySlider = document.getElementById("opacity");
osmLayer.setOpacity(opacitySlider.value);
opacitySlider.addEventListener("input", function(e){
  osmLayer.setOpacity(e.target.value);
});

// üîπ carregar KML manualment
// Nom del KML: escriu aqu√≠ el fitxer que tens dins la carpeta
const KML_FILE = "01_OllaDeNuria_4164m.kml";

omnivore.kml(KML_FILE)
.on('ready', function() {
    var kmlLayer = this;

    // sense color interior
    kmlLayer.eachLayer(function(layer){
        if(layer.setStyle){
            layer.setStyle({
                fill: false,
                fillOpacity: 0,
                color: "#FFAA00",
                weight: 3,
                opacity: 0.8
            });
        }
    });

    map.addLayer(kmlLayer);
    map.fitBounds(kmlLayer.getBounds());
})
.on('error', function(e){
    console.error("Error carregant KML", e);
});
</script>

</body>
</html>