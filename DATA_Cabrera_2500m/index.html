<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="utf-8" />
<title>Mapa 3D amb Selector de Capa</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  body { margin:0; padding:0; }
  #map { width: 100%; height: 100vh; }
</style>
</head>
<body>
<div id="map"></div>

<script>
  // Inicialitza el mapa
  var map = L.map('map', {center: [42.07, 2.43], zoom: 14});

  // --- CAPES BASE ---
  var topoICGC = L.tileLayer('https://geoserveis.icgc.cat/icc_mapesmultibase/noutm/wmts/topo/{z}/{x}/{y}.jpeg', {
      attribution: 'ICGC Topogràfic',
      maxZoom: 19,
      tms: false
  });

  var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'OSM',
      maxZoom: 19
  });

  // Afegeix el topo ICGC per defecte
  topoICGC.addTo(map);

  // --- OVERLAY ORTO HISTÒRICA 1956 ---
  var orto1956 = L.tileLayer.wms("https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms", {
      layers: 'ortofoto_blanc_i_negre_1956',
      format: 'image/png',
      transparent: true,
      version: '1.3.0',
      crs: L.CRS.EPSG3857
  });

  // --- GEOJSON ---
  var geojsonLayer;
  fetch('01_cabrera_2500m_4326.geojson')
    .then(response => response.json())
    .then(data => {
        geojsonLayer = L.geoJSON(data, {
            style: {color: 'red', weight: 2, fillOpacity: 0.3}
        }).addTo(map);
        map.fitBounds(geojsonLayer.getBounds());
    });

  // --- SELECTOR DE CAPES ---
  var baseMaps = {
    "Topo ICGC": topoICGC,
    "OSM": osm
  };

  var overlayMaps = {
    "Orto 1956": orto1956,
    "GeoJSON": geojsonLayer  // s'afegeix després de fetch()
  };

  var layerControl = L.control.layers(baseMaps, overlayMaps, {collapsed:false}).addTo(map);
</script>
</body>
</html>